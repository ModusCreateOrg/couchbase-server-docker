
# Couchbase Server start script which runs the process in the foreground
# which is the typical way you would run it in a docker container

if [ "$(id -u)" != "0" ]; then
    echo "This script must be run as root"
    exit 1
fi

COUCHBASE_SERVER=/opt/couchbase/bin/couchbase-server

# Create directories where couchbase stores its data
cd /opt/couchbase
mkdir -p var/lib/couchbase \
         var/lib/couchbase/config \
         var/lib/couchbase/data \
         var/lib/couchbase/stats \
         var/lib/couchbase/logs \
         var/lib/moxi
chown -R couchbase:couchbase var

# Increase ulimits
ulimit -n 40960
ulimit -c unlimited
ulimit -l unlimited

# Start couchbase, pass -noinput so it doesn't drop us in the erlang shell
sudo -u couchbase $COUCHBASE_SERVER -- -noinput
